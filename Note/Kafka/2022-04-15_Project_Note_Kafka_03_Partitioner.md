# Project Note: Kafka Partitioner, etc

>[파티셔너의 역할과 동작! 파티션으로 가는 길목!](https://www.youtube.com/watch?v=-vKiNUH5OT8)

## Partitioner

프로듀서가 데이터를 보내면 무조건 파티셔너를 통해서 브로커로 데이터가 전송된다. 

데이터를 어떤 파티션에 넣을 지 결정하는 역할을 한다. 

레코드에 포함된 메시지 키, 또는 메시지 값에 따라 파티션의 위치가 결정된다. 



**UniformStickyPartitioner** 

- 프로듀서 설정 시 따로 파티셔너 설정을 하지 않는다면 사용하는 파티셔너 
- 메시지 키가 있는 경우 / 없는 경우에 따라 다르다. 
- 메시지 키가 있는 경우 파티셔너에 의해서 특정한 해쉬값이 생성되고, 어느 파티션에 들어갈 지 정해지게 된다. 
  - 동일한 메시지 키에 대해서, 동일한 해쉬값을 만들기 때문에, 항상 동일한 파티션에 들어가는 것을 보장한다. 
  - 따라서 결국, 순서를 지켜서 데이터를 처리할 수 있다는 장점이 있다. 
- 메시지 키가 없는 경우, 데이터가 라운드 로빈으로 파티션에 들어간다.
  - 전통적인 방식과는 조금 다르다. 
  - 프로듀서에서 배치로 모을 수 있는 최대한의 레코드를 모아서 파티션으로 보낸다. 
    - 이렇게 배치단위로 보낼 때, 라운드 로빈 방식으로 파티션에 넣는 방식이다. 
  - 따라서 파티션에 적절히 분배된다. 

**Partitioner Interface**

- 직접 개발한 파티셔너를 프로듀서에 설정할 수 있다. 

- 커스텀 파티셔너를 개발하여, 메시지 키, 메시지 값 또는 토픽 이름에 따라 어느 파티션에 데이터를 보낼 것인지 정할 수 있다. 
- AMQP 메시지 시스템에서 우선순위 큐를 만드는 것과 비슷한 방식으로 사용 가능하다. 



## Consumer Lag



